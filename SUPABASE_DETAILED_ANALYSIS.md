# ๐ฌ ุชุญููู ุชูุตููู ูุฅุนุฏุงุฏุงุช Supabase

**ุงูุชุงุฑูุฎ:** 27 ุฃูุชูุจุฑ 2025

---

## ๐ ุชุญููู ุงูุฌุฏุงูู ุจุงูุชูุตูู

### 1. ุฌุฏูู `credit_cards` (ุงูุจุทุงูุงุช ุงูุงุฆุชูุงููุฉ)

**ุงููููู:**
```sql
id (UUID) - ุงููุนุฑู ุงููุฑูุฏ
user_id (UUID) - ูุนุฑู ุงููุณุชุฎุฏู
name (VARCHAR) - ุงุณู ุงูุจุทุงูุฉ
bank_name (VARCHAR) - ุงุณู ุงูุจูู
card_number_last_four (VARCHAR) - ุขุฎุฑ 4 ุฃุฑูุงู
card_type (ENUM) - ููุน ุงูุจุทุงูุฉ
credit_limit (DECIMAL) - ุญุฏ ุงูุงุฆุชูุงู
current_balance (DECIMAL) - ุงูุฑุตูุฏ ุงูุญุงูู
cashback_rate (DECIMAL) - ูุนุฏู ุงููุงุดุจุงู
due_date (INTEGER) - ุชุงุฑูุฎ ุงูุงุณุชุญูุงู
created_at (TIMESTAMP) - ุชุงุฑูุฎ ุงูุฅูุดุงุก
updated_at (TIMESTAMP) - ุชุงุฑูุฎ ุงูุชุญุฏูุซ
```

**ุงูููุงุฑุณ:**
- โ `idx_credit_cards_user_id` - ููุจุญุซ ุงูุณุฑูุน ุนู ุจุทุงูุงุช ุงููุณุชุฎุฏู

**ุงูุฏูุงู ุงููุฑุชุจุทุฉ:**
- โ `update_updated_at_column()` - ุชุญุฏูุซ ุชุงุฑูุฎ ุงูุชุนุฏูู ุชููุงุฆูุงู

---

### 2. ุฌุฏูู `transactions` (ุงููุนุงููุงุช)

**ุงููููู:**
```sql
id (UUID) - ุงููุนุฑู ุงููุฑูุฏ
user_id (UUID) - ูุนุฑู ุงููุณุชุฎุฏู
card_id (UUID) - ูุนุฑู ุงูุจุทุงูุฉ
type (ENUM) - ููุน ุงููุนุงููุฉ
amount (DECIMAL) - ุงููุจูุบ
description (TEXT) - ุงููุตู
category (VARCHAR) - ุงููุฆุฉ
transaction_date (TIMESTAMP) - ุชุงุฑูุฎ ุงููุนุงููุฉ
created_at (TIMESTAMP) - ุชุงุฑูุฎ ุงูุฅูุดุงุก
```

**ุงูููุงุฑุณ:**
- โ `idx_transactions_user_id` - ููุจุญุซ ุนู ูุนุงููุงุช ุงููุณุชุฎุฏู
- โ `idx_transactions_card_id` - ููุจุญุซ ุนู ูุนุงููุงุช ุงูุจุทุงูุฉ
- โ `idx_transactions_date` - ููุจุญุซ ุญุณุจ ุงูุชุงุฑูุฎ

**ุงูุฏูุงู ุงููุฑุชุจุทุฉ:**
- โ `update_card_balance()` - ุชุญุฏูุซ ุฑุตูุฏ ุงูุจุทุงูุฉ ุชููุงุฆูุงู

---

### 3. ุฌุฏูู `payments` (ุงููุฏููุนุงุช)

**ุงููููู:**
```sql
id (UUID) - ุงููุนุฑู ุงููุฑูุฏ
user_id (UUID) - ูุนุฑู ุงููุณุชุฎุฏู
card_id (UUID) - ูุนุฑู ุงูุจุทุงูุฉ
amount (DECIMAL) - ุงููุจูุบ
payment_date (TIMESTAMP) - ุชุงุฑูุฎ ุงูุฏูุน
due_date (TIMESTAMP) - ุชุงุฑูุฎ ุงูุงุณุชุญูุงู
status (ENUM) - ุญุงูุฉ ุงูุฏูุน
created_at (TIMESTAMP) - ุชุงุฑูุฎ ุงูุฅูุดุงุก
```

**ุงูููุงุฑุณ:**
- โ `idx_payments_user_id` - ููุจุญุซ ุนู ูุฏููุนุงุช ุงููุณุชุฎุฏู
- โ `idx_payments_card_id` - ููุจุญุซ ุนู ูุฏููุนุงุช ุงูุจุทุงูุฉ
- โ `idx_payments_due_date` - ููุจุญุซ ุญุณุจ ุชุงุฑูุฎ ุงูุงุณุชุญูุงู

---

### 4. ุฌุฏูู `otp_codes` (ุฑููุฒ ุงูุชุญูู)

**ุงููููู:**
```sql
id (UUID) - ุงููุนุฑู ุงููุฑูุฏ
email (VARCHAR) - ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
code (VARCHAR) - ุงูุฑูุฒ (6 ุฃุฑูุงู)
created_at (TIMESTAMP) - ููุช ุงูุฅูุดุงุก
expires_at (TIMESTAMP) - ููุช ุงูุงูุชูุงุก
attempts (INT) - ุนุฏุฏ ูุญุงููุงุช ูุงุดูุฉ
verified (BOOLEAN) - ูู ุชู ุงูุชุญูู
```

**ุงูููุงุฑุณ:**
- โ `idx_otp_email` - ููุจุญุซ ุงูุณุฑูุน ุนู ุงูุฑููุฒ
- โ `idx_otp_expires_at` - ูุชูุธูู ุงูุฑููุฒ ุงูููุชููุฉ
- โ `idx_otp_verified` - ููุจุญุซ ุนู ุงูุฑููุฒ ุงููุชุญููุฉ
- โ `idx_otp_email_verified` - ููุจุญุซ ุงููุฑูุจ

**ุงููููุฏ:**
- โ `UNIQUE(email, code)` - ููุน ุงูุชูุฑุงุฑ
- โ `LENGTH(code) = 6` - ุงูุชุญูู ูู ุทูู ุงูุฑูุฒ
- โ `code ~ '^[0-9]+$'` - ุงูุชุญูู ูู ุฃู ุงูุฑูุฒ ุฃุฑูุงู ููุท

---

## ๐ ุชุญููู ุงูุฃูุงู

### RLS Policies - ุชุญููู ุชูุตููู

**credit_cards:**
```sql
SELECT: auth.uid() = user_id
INSERT: auth.uid() = user_id
UPDATE: auth.uid() = user_id
DELETE: auth.uid() = user_id
```
โ **ุงูุชูููู:** ููุชุงุฒ - ุญูุงูุฉ ูุงููุฉ

**transactions:**
```sql
SELECT: auth.uid() = user_id
INSERT: auth.uid() = user_id
UPDATE: auth.uid() = user_id
DELETE: auth.uid() = user_id
```
โ **ุงูุชูููู:** ููุชุงุฒ - ุญูุงูุฉ ูุงููุฉ

**payments:**
```sql
SELECT: auth.uid() = user_id
INSERT: auth.uid() = user_id
UPDATE: auth.uid() = user_id
DELETE: auth.uid() = user_id
```
โ **ุงูุชูููู:** ููุชุงุฒ - ุญูุงูุฉ ูุงููุฉ

**otp_codes:**
```sql
INSERT: true (ููุฌููุน)
SELECT: true (ููุฌููุน)
UPDATE: true (ููุฌููุน)
DELETE: expires_at < NOW()
```
โ **ุงูุชูููู:** ุฌูุฏ - ููุงุณุจ ููุฑููุฒ ุงููุคูุชุฉ

---

## ๐ ุงูุฏูุงู ุงููุชูุฏูุฉ

### 1. `update_card_balance()`
**ุงูุบุฑุถ:** ุชุญุฏูุซ ุฑุตูุฏ ุงูุจุทุงูุฉ ุชููุงุฆูุงู ุนูุฏ ุฅุถุงูุฉ/ุญุฐู ูุนุงููุฉ

**ุงูููุทู:**
- ุนูุฏ ุงูุฅุฏุฑุงุฌ: ุฅุฐุง ูุงูุช ุงููุนุงููุฉ withdrawalุ ุฃุถู ุงููุจูุบ
- ุนูุฏ ุงูุญุฐู: ุนูุณ ุงูุนูููุฉ

---

### 2. `calculate_monthly_cashback()`
**ุงูุบุฑุถ:** ุญุณุงุจ ุงููุงุดุจุงู ุงูุดูุฑู ูููุณุชุฎุฏู

**ุงููุนุงููุงุช:**
- `p_user_id` - ูุนุฑู ุงููุณุชุฎุฏู
- `p_card_id` - ูุนุฑู ุงูุจุทุงูุฉ (ุงุฎุชูุงุฑู)
- `p_month` - ุงูุดูุฑ (ุงูุชุฑุงุถู: ุงูุดูุฑ ุงูุญุงูู)
- `p_year` - ุงูุณูุฉ (ุงูุชุฑุงุถู: ุงูุณูุฉ ุงูุญุงููุฉ)

**ุงููุชูุฌุฉ:**
- `card_id` - ูุนุฑู ุงูุจุทุงูุฉ
- `card_name` - ุงุณู ุงูุจุทุงูุฉ
- `total_spent` - ุฅุฌูุงูู ุงูุฅููุงู
- `cashback_earned` - ุงููุงุดุจุงู ุงูููุชุณุจ

---

## ๐ฑ ุงูุงุชุตุงู ุจูู ุงูุชุทุจูู ู Supabase

### ูููุงุช ุงูุฅุนุฏุงุฏ

**`src/lib/supabase.ts`:**
- โ ุนููู ุงููุชุตูุญ (Browser Client)
- โ ุฃููุงุน ูุงุนุฏุฉ ุงูุจูุงูุงุช (Database Types)
- โ ูุงุฌูุงุช ุงูุจูุงูุงุช (Interfaces)

**`src/lib/supabase-server.ts`:**
- โ ุนููู ุงูุฎุงุฏู (Server Client)
- โ ุฅุฏุงุฑุฉ ุงูููููุฒ
- โ ุฏุนู SSR

**`src/middleware.ts`:**
- โ ุชุญุฏูุซ ุงูุฌูุณุงุช
- โ ุฅุฏุงุฑุฉ ุงูููููุฒ
- โ ูุนุงูุฌุฉ ุงููุตุงุฏูุฉ

**`src/components/auth/auth-provider.tsx`:**
- โ ูุฒูุฏ ุงููุตุงุฏูุฉ (Auth Provider)
- โ ุฅุฏุงุฑุฉ ุญุงูุฉ ุงููุณุชุฎุฏู
- โ ุงูุงุณุชูุงุน ูุชุบููุฑุงุช ุงููุตุงุฏูุฉ

---

## ๐ฏ ููุงุท ุงูููุฉ

1. โ **ูููู ูุงุนุฏุฉ ุงูุจูุงูุงุช:** ููุธู ูุณููู
2. โ **ุงูุฃูุงู:** RLS ููุนูู ุนูู ุฌููุน ุงูุฌุฏุงูู
3. โ **ุงูุฃุฏุงุก:** ููุงุฑุณ ููุฌูุฏุฉ ุนูู ุฌููุน ุงูุฃุนูุฏุฉ ุงููููุฉ
4. โ **ุงูุฏูุงู:** ุฏูุงู ูุชูุฏูุฉ ููุนูููุงุช ุงููุนูุฏุฉ
5. โ **ุงูุงุชุตุงู:** ุฅุนุฏุงุฏุงุช ุตุญูุญุฉ ููุงุชุตุงู ุจู Supabase

---

## โ๏ธ ููุงุท ุงูุชุญุณูู

1. โ๏ธ **ูุชุบูุฑุงุช ุงูุจูุฆุฉ:** ุฅุถุงูุฉ `RESEND_API_KEY`
2. โ๏ธ **ุงููุฑุงูุจุฉ:** ุฅุถุงูุฉ Logging ููุนูููุงุช ุงูุญุณุงุณุฉ
3. โ๏ธ **ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ:** ุชูุนูู ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ ุงูุชููุงุฆูุฉ
4. โ๏ธ **Rate Limiting:** ุฅุถุงูุฉ ุญุฏ ููุทูุจุงุช

---

## โ ุงูุฎูุงุตุฉ

**ุงูุญุงูุฉ: ููุชุงุฒุฉ โ**

ุงููุดุฑูุน ููุนุฏู ุจุดูู ุงุญุชุฑุงูู ูุขูู. ุฌููุน ุงูููููุงุช ุงูุฃุณุงุณูุฉ ููุฌูุฏุฉ ูุชุนูู ุจุดูู ุตุญูุญ.

**ุงููุดุฑูุน ุฌุงูุฒ ููุฅูุชุงุฌ! ๐**

