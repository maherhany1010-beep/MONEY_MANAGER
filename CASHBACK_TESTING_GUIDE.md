# 🧪 دليل اختبار نظام الكاش باك

## 📍 الوصول إلى النظام

**الرابط**: `http://localhost:3003/cards/1`

**الخطوات**:
1. افتح الرابط في المتصفح
2. انتقل إلى تبويب **"الكاش باك"** 🎁

---

## ✅ سيناريوهات الاختبار

### 🧪 اختبار 1: إضافة كاش باك جديد (3 دقائق)

**الهدف**: التأكد من إمكانية إضافة سجل كاش باك جديد

**الخطوات**:
1. ✅ انقر زر **"إضافة كاش باك"**
2. ✅ املأ البيانات:
   - المبلغ: `100`
   - المصدر: `عملية شراء من كارفور`
   - تاريخ الحصول: (اليوم)
   - الوصف: `كاش باك على مشتريات البقالة`
3. ✅ **لا تفعّل** الاسترداد التلقائي
4. ✅ انقر **"إضافة الكاش باك"**

**النتيجة المتوقعة**:
- ✅ رسالة نجاح: "تم إضافة الكاش باك بنجاح!"
- ✅ ظهور السجل في قائمة "سجلات الكاش باك"
- ✅ الحالة: **معلق** (Badge أصفر)
- ✅ المبلغ: **100.00 جنيه**
- ✅ المتبقي: **100.00 جنيه**
- ✅ تحديث الإحصائيات:
  - إجمالي الكاش باك: +100
  - الرصيد المتاح: +100

---

### 🧪 اختبار 2: استرداد كلي لرصيد البطاقة (4 دقائق)

**الهدف**: اختبار الاسترداد الكلي وإضافة المبلغ لرصيد البطاقة

**الخطوات**:
1. ✅ على السجل الذي أضفته، انقر **"استرداد الكاش باك"**
2. ✅ في نافذة الاسترداد:
   - نوع الاسترداد: **استرداد كلي** ✅
   - طريقة الاسترداد: **💰 إضافة لرصيد البطاقة** ✅
3. ✅ تحقق من ملخص الاسترداد:
   - المبلغ المسترد: `100.00 جنيه`
   - المتبقي بعد الاسترداد: `0.00 جنيه`
4. ✅ انقر **"استرداد الكاش باك"**

**النتيجة المتوقعة**:
- ✅ رسالة نجاح: "تم استرداد الكاش باك بنجاح!"
- ✅ تحديث السجل:
  - الحالة: **مسترد** (Badge أخضر)
  - مسترد: `100.00 جنيه`
  - متبقي: `0.00 جنيه`
  - زر "استرداد الكاش باك" **مخفي**
- ✅ ظهور عملية استرداد جديدة في قسم "عمليات الاسترداد":
  - النوع: **💰 رصيد البطاقة**
  - المبلغ: `100.00 جنيه`
  - Badge: **كلي**
- ✅ تحديث الإحصائيات:
  - المسترد: +100
  - الرصيد المتاح: -100 (يصبح 0)

---

### 🧪 اختبار 3: إضافة كاش باك مع استرداد تلقائي (5 دقائق)

**الهدف**: اختبار الاسترداد التلقائي

**الخطوات**:
1. ✅ انقر **"إضافة كاش باك"**
2. ✅ املأ البيانات:
   - المبلغ: `250`
   - المصدر: `تسوق أونلاين من أمازون`
   - تاريخ الحصول: (اليوم)
3. ✅ **فعّل** الاسترداد التلقائي ✅
4. ✅ اختر عدد الأيام: انقر زر **"يومين"** (2 أيام)
5. ✅ تحقق من ظهور رسالة:
   - "تاريخ الاسترداد التلقائي المتوقع: [بعد يومين]"
6. ✅ انقر **"إضافة الكاش باك"**

**النتيجة المتوقعة**:
- ✅ ظهور السجل الجديد
- ✅ في تفاصيل السجل، ظهور:
  - ⏰ **استرداد تلقائي: [التاريخ بعد يومين]** (نص أزرق)
- ✅ تحديث الإحصائيات:
  - إجمالي الكاش باك: +250
  - الرصيد المتاح: +250

---

### 🧪 اختبار 4: استرداد جزئي كقسيمة مشتريات (6 دقائق)

**الهدف**: اختبار الاسترداد الجزئي والقسائم

**الخطوات**:
1. ✅ على السجل الأخير (250 جنيه)، انقر **"استرداد الكاش باك"**
2. ✅ في نافذة الاسترداد:
   - نوع الاسترداد: **استرداد جزئي** ✅
   - المبلغ المراد استرداده: `150`
   - طريقة الاسترداد: **🎫 قسيمة مشتريات** ✅
3. ✅ في تفاصيل القسيمة:
   - اسم المكان: `كارفور مصر`
   - كود القسيمة: `VOUCHER2025`
   - تاريخ انتهاء القسيمة: (بعد شهر)
4. ✅ تحقق من ملخص الاسترداد:
   - المبلغ المسترد: `150.00 جنيه`
   - طريقة الاسترداد: `🎫 قسيمة مشتريات`
   - المكان: `كارفور مصر`
   - المتبقي بعد الاسترداد: `100.00 جنيه`
5. ✅ انقر **"استرداد الكاش باك"**

**النتيجة المتوقعة**:
- ✅ رسالة نجاح
- ✅ تحديث السجل:
  - الحالة: **معتمد** (Badge أزرق) - لأنه لا يزال هناك متبقي
  - مسترد: `150.00 جنيه`
  - متبقي: `100.00 جنيه`
  - زر "استرداد الكاش باك" **لا يزال ظاهراً**
- ✅ ظهور عملية استرداد جديدة:
  - النوع: **🎫 قسيمة مشتريات**
  - المكان: **📍 كارفور مصر**
  - كود: `VOUCHER2025`
  - المبلغ: `150.00 جنيه`
  - Badge: **جزئي**
- ✅ تحديث الإحصائيات:
  - المسترد: +150
  - الرصيد المتاح: -150

---

### 🧪 اختبار 5: إعدادات الكاش باك (4 دقائق)

**الهدف**: اختبار تخصيص إعدادات البطاقة

**الخطوات**:
1. ✅ انقر زر **"الإعدادات"** ⚙️
2. ✅ في نافذة الإعدادات:
   
   **الإعدادات العامة**:
   - تفعيل الكاش باك: ✅ مفعّل
   - نسبة الكاش باك: `2.5` %
   
   **الاسترداد التلقائي**:
   - تفعيل الاسترداد التلقائي: ✅ مفعّل
   - عدد الأيام: انقر زر **"شهر"** (30 يوم)
   - نوع الاسترداد: **🎫 قسيمة مشتريات**
   - اسم المكان للقسيمة: `سبينيس`
   
   **الحدود**:
   - الحد الأدنى للاسترداد: `50` جنيه
   - الحد الأقصى للكاش باك لكل عملية: `500` جنيه

3. ✅ انقر **"حفظ الإعدادات"**

**النتيجة المتوقعة**:
- ✅ رسالة نجاح: "تم حفظ الإعدادات بنجاح!"
- ✅ الإعدادات محفوظة في localStorage
- ✅ عند إضافة كاش باك جديد بتفعيل الاسترداد التلقائي، سيتم استخدام هذه الإعدادات

---

### 🧪 اختبار 6: معالجة الاستردادات التلقائية (3 دقائق)

**الهدف**: اختبار معالجة الاستردادات المستحقة

**ملاحظة**: هذا الاختبار يتطلب تعديل تاريخ الاسترداد التلقائي يدوياً في localStorage أو انتظار الموعد المحدد.

**الخطوات (للاختبار الفوري)**:
1. ✅ افتح Developer Tools (F12)
2. ✅ انتقل إلى Console
3. ✅ نفذ الكود التالي لتعديل التاريخ:
```javascript
const records = JSON.parse(localStorage.getItem('cashbackRecords'))
records[0].autoRedeemDate = new Date().toISOString().split('T')[0]
localStorage.setItem('cashbackRecords', JSON.stringify(records))
location.reload()
```
4. ✅ بعد إعادة التحميل، انقر **"معالجة الاستردادات التلقائية"**

**النتيجة المتوقعة**:
- ✅ استرداد تلقائي للسجلات المستحقة
- ✅ ظهور عمليات استرداد جديدة مع Badge **"تلقائي"**
- ✅ تحديث حالة السجلات إلى "مسترد"

---

## 📊 جدول الاختبار

| # | الاختبار | الوقت | الحالة |
|---|----------|-------|--------|
| 1 | إضافة كاش باك جديد | 3 دقائق | ⬜ |
| 2 | استرداد كلي لرصيد البطاقة | 4 دقائق | ⬜ |
| 3 | إضافة مع استرداد تلقائي | 5 دقائق | ⬜ |
| 4 | استرداد جزئي كقسيمة | 6 دقائق | ⬜ |
| 5 | إعدادات الكاش باك | 4 دقائق | ⬜ |
| 6 | معالجة الاستردادات التلقائية | 3 دقائق | ⬜ |
| **المجموع** | | **25 دقيقة** | |

**رموز الحالة**:
- ⬜ لم يُختبر
- ✅ نجح
- ❌ فشل
- ⚠️ يحتاج مراجعة

---

## 🎯 نقاط التحقق الرئيسية

### ✅ الوظائف الأساسية:
- [ ] إضافة سجل كاش باك جديد
- [ ] استرداد كلي
- [ ] استرداد جزئي
- [ ] استرداد لرصيد البطاقة
- [ ] استرداد كقسيمة مشتريات
- [ ] إدخال اسم المكان للقسيمة
- [ ] الاسترداد التلقائي
- [ ] حفظ الإعدادات

### ✅ الإحصائيات:
- [ ] إجمالي الكاش باك يتحدث بشكل صحيح
- [ ] الرصيد المتاح يتحدث بشكل صحيح
- [ ] المسترد يتحدث بشكل صحيح
- [ ] المعلق يتحدث بشكل صحيح

### ✅ الواجهة:
- [ ] الألوان واضحة ومتناسقة
- [ ] الأيقونات مناسبة
- [ ] الرسائل واضحة
- [ ] التنقل سلس
- [ ] الأزرار تعمل بشكل صحيح

### ✅ التخزين:
- [ ] البيانات تُحفظ في localStorage
- [ ] البيانات تُحمّل عند إعادة التحميل
- [ ] لا توجد أخطاء في Console

---

## 🐛 الإبلاغ عن المشاكل

إذا واجهت أي مشكلة، سجل التفاصيل التالية:

**معلومات المشكلة**:
- رقم الاختبار: _______
- الخطوة: _______
- النتيجة المتوقعة: _______
- النتيجة الفعلية: _______
- رسالة الخطأ (إن وجدت): _______
- لقطة شاشة: _______

**معلومات البيئة**:
- المتصفح: _______
- نظام التشغيل: _______
- التاريخ والوقت: _______

---

## 🎉 بعد الاختبار

إذا نجحت جميع الاختبارات:
1. ✅ ضع علامة ✅ على جميع الاختبارات
2. ✅ راجع الإحصائيات النهائية
3. ✅ تحقق من localStorage في Developer Tools
4. ✅ جرب السيناريوهات الإضافية (اختياري)

إذا فشل أي اختبار:
1. ❌ سجل التفاصيل في قسم "الإبلاغ عن المشاكل"
2. ❌ التقط لقطات شاشة
3. ❌ افحص Console للأخطاء
4. ❌ أبلغني بالمشكلة

---

**جاهز للاختبار؟ ابدأ الآن! 🚀**

**الرابط**: `http://localhost:3003/cards/1`

