# ๐ ุฏููู ุชุทุจูู ูุธุงู OTP

**ุงูุชุงุฑูุฎ:** 26 ุฃูุชูุจุฑ 2025  
**ุงูุญุงูุฉ:** ๐ ุฏููู ุงูุชุทุจูู

---

## ๐ ููุฎุต ุงูุชุทุจูู

ุชู ุฅูุดุงุก ูุธุงู OTP ุดุงูู ูุชุถูู:

1. โ ุฏูุงู OTP (`src/lib/otp.ts`)
2. โ ูููุฐุฌ OTP (`src/components/auth/otp-form.tsx`)
3. โ ุตูุญุฉ ุงูุชูุนูู (`src/app/verify-otp/page.tsx`)
4. โ ุฌุฏูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (`supabase/migrations/create_otp_table.sql`)
5. โ ุฏููู ุฅุนุฏุงุฏุงุช Supabase (`SUPABASE_EMAIL_CONFIG.md`)

---

## ๐ ุฎุทูุงุช ุงูุชุทุจูู

### ุงูุฎุทูุฉ 1: ุชุทุจูู ุงููุฌุฑุฉ ูู Supabase

```bash
# 1. ุงุฐูุจ ุฅูู Supabase Dashboard
https://app.supabase.com/

# 2. ุงุฎุชุฑ ุงููุดุฑูุน: MONEY_MANAGER

# 3. ุงุฐูุจ ุฅูู: SQL Editor

# 4. ุงูุณุฎ ูุญุชูู ุงูููู:
supabase/migrations/create_otp_table.sql

# 5. ุงูุตู ูู SQL Editor ูุงุถุบุท: Run
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
```
โ ุฌุฏูู otp_codes ุชู ุฅูุดุงุคู
โ Indexes ุชู ุฅูุดุงุคูุง
โ RLS Policies ุชู ุชูุนูููุง
```

---

### ุงูุฎุทูุฉ 2: ุชุฎุตูุต Email Templates

ุงุชุจุน ุงูุฎุทูุงุช ูู: `SUPABASE_EMAIL_CONFIG.md`

**ุงูููุงุท ุงููููุฉ:**
- โ ุบููุฑ ุงุณู ุงููุฑุณู ุฅูู: "ุงูุฅุฏุงุฑุฉ ุงููุงููุฉ ุงูุดุงููุฉ"
- โ ุบููุฑ ุงูุจุฑูุฏ ุฅูู: noreply@moneymanager.com
- โ ุฃุถู ุดุนุงุฑ ุงููููุน (ุฅู ุฃููู)

---

### ุงูุฎุทูุฉ 3: ุชุญุฏูุซ ูููุฐุฌ ุงูุชุณุฌูู

**ุงูููู:** `src/components/auth/login-form.tsx`

**ุงูุชุนุฏููุงุช ุงููุทููุจุฉ:**

```typescript
// ูู ุฏุงูุฉ handleSignUpุ ุจุฏูุงู ูู:
const { error } = await supabase.auth.signUp({
  email,
  password,
  options: {
    emailRedirectTo: `${window.location.origin}/auth/callback`,
  },
})

// ุงุณุชุฎุฏู:
import { generateOTP, sendOTPEmail } from '@/lib/otp'

const otp = generateOTP()
const { success, error: otpError } = await sendOTPEmail(email, otp)

if (success) {
  // ุฅุนุงุฏุฉ ุชูุฌูู ุฅูู ุตูุญุฉ ุงูุชูุนูู
  router.push(`/verify-otp?email=${encodeURIComponent(email)}`)
} else {
  setError(otpError || 'ูุดู ูู ุฅุฑุณุงู ุงูุฑูุฒ')
}
```

---

### ุงูุฎุทูุฉ 4: ุงุฎุชุจุงุฑ ุงููุธุงู ูุญููุงู

```bash
# 1. ุดุบูู ุงูุชุทุจูู
npm run dev

# 2. ุงุฐูุจ ุฅูู ุตูุญุฉ ุงูุชุณุฌูู
http://localhost:3000/login

# 3. ุงุฎุชุฑ: ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ

# 4. ุฃุฏุฎู:
- ุงูุจุฑูุฏ: test@example.com
- ูููุฉ ุงููุฑูุฑ: Test123456

# 5. ุชุญูู ูู:
- โ ูู ุชู ุฅุฑุณุงู ุงูุจุฑูุฏุ
- โ ูู ุชู ุงูุงูุชูุงู ุฅูู ุตูุญุฉ ุงูุชูุนููุ
- โ ูู ููููู ุฅุฏุฎุงู ุงูุฑูุฒุ
```

---

## ๐ ุงููููุงุช ุงูุฌุฏูุฏุฉ

### 1. `src/lib/otp.ts`
**ุงููุธููุฉ:** ุฏูุงู OTP ุงูุฃุณุงุณูุฉ

**ุงูุฏูุงู:**
- `generateOTP()` - ุชูููุฏ ุฑูุฒ ุนุดูุงุฆู
- `sendOTPEmail()` - ุฅุฑุณุงู ุงูุฑูุฒ ุนุจุฑ ุงูุจุฑูุฏ
- `verifyOTP()` - ุงูุชุญูู ูู ุงูุฑูุฒ
- `incrementOTPAttempts()` - ุฒูุงุฏุฉ ุนุฏุฏ ุงููุญุงููุงุช
- `resendOTP()` - ุฅุนุงุฏุฉ ุฅุฑุณุงู ุงูุฑูุฒ
- `cleanupExpiredOTPs()` - ุญุฐู ุงูุฑููุฒ ุงูููุชููุฉ

### 2. `src/components/auth/otp-form.tsx`
**ุงููุธููุฉ:** ูููุฐุฌ ุฅุฏุฎุงู ุงูุฑูุฒ

**ุงูููุฒุงุช:**
- โ ุฅุฏุฎุงู 6 ุฃุฑูุงู ููุท
- โ ุนุฏุงุฏ ุงููุญุงููุงุช
- โ ุฒุฑ ุฅุนุงุฏุฉ ุงูุฅุฑุณุงู ูุน ุนุฏุงุฏ
- โ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ
- โ ุชุตููู ุงุญุชุฑุงูู

### 3. `src/app/verify-otp/page.tsx`
**ุงููุธููุฉ:** ุตูุญุฉ ุงูุชูุนูู

**ุงูููุฒุงุช:**
- โ ุงุณุชูุจุงู ุงูุจุฑูุฏ ูู URL
- โ ุนุฑุถ ูููุฐุฌ OTP
- โ ุฅุนุงุฏุฉ ุชูุฌูู ุนูุฏ ุงููุฌุงุญ
- โ ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก

### 4. `supabase/migrations/create_otp_table.sql`
**ุงููุธููุฉ:** ุฅูุดุงุก ุฌุฏูู OTP

**ุงูุฌุฏูู:**
- `id` - ูุนุฑู ูุฑูุฏ
- `email` - ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
- `code` - ุงูุฑูุฒ (6 ุฃุฑูุงู)
- `created_at` - ููุช ุงูุฅูุดุงุก
- `expires_at` - ููุช ุงูุชูุงุก ุงูุตูุงุญูุฉ
- `attempts` - ุนุฏุฏ ุงููุญุงููุงุช
- `verified` - ูู ุชู ุงูุชุญูู

---

## ๐ง ุงูุฅุนุฏุงุฏุงุช

### OTP Configuration

```typescript
export const OTP_CONFIG = {
  LENGTH: 6,                    // ุทูู ุงูุฑูุฒ
  VALIDITY_MINUTES: 10,         // ุตูุงุญูุฉ ุงูุฑูุฒ (ุฏูุงุฆู)
  MAX_ATTEMPTS: 5,              // ุนุฏุฏ ุงููุญุงููุงุช ุงููุณููุญุฉ
  RESEND_COOLDOWN_SECONDS: 60,  // ููุช ุงูุงูุชุธุงุฑ ูุจู ุฅุนุงุฏุฉ ุงูุฅุฑุณุงู
}
```

---

## ๐งช ุงูุณููุงุฑูููุงุช ุงููุฎุชุจุฑุฉ

### โ ุงูุณููุงุฑูู 1: ุชุณุฌูู ุญุณุงุจ ุฌุฏูุฏ
```
1. ุงููุณุชุฎุฏู ูุฏุฎู ุงูุจุฑูุฏ ููููุฉ ุงููุฑูุฑ
2. ูุชู ุฅุฑุณุงู OTP ุฅูู ุงูุจุฑูุฏ
3. ุงููุณุชุฎุฏู ููุชูู ุฅูู ุตูุญุฉ ุงูุชูุนูู
4. ูุฏุฎู ุงูุฑูุฒ
5. ูุชู ุงูุชุญูู ูุงูุงูุชูุงู ุฅูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
```

### โ ุงูุณููุงุฑูู 2: ุฑูุฒ ุฎุงุทุฆ
```
1. ุงููุณุชุฎุฏู ูุฏุฎู ุฑูุฒ ุฎุงุทุฆ
2. ูุชู ุนุฑุถ ุฑุณุงูุฉ ุฎุทุฃ
3. ูุชู ุฒูุงุฏุฉ ุนุฏุฏ ุงููุญุงููุงุช
4. ุจุนุฏ 5 ูุญุงููุงุชุ ูุชู ููู ุงูุญุณุงุจ
```

### โ ุงูุณููุงุฑูู 3: ุฅุนุงุฏุฉ ุฅุฑุณุงู ุงูุฑูุฒ
```
1. ุงููุณุชุฎุฏู ูููุฑ ุนูู "ุฅุนุงุฏุฉ ุงูุฅุฑุณุงู"
2. ูุชู ุงูุชุญูู ูู ููุช ุงูุงูุชุธุงุฑ
3. ูุชู ุฅุฑุณุงู ุฑูุฒ ุฌุฏูุฏ
4. ูุชู ุชุญุฏูุซ ุนุฏุงุฏ ุงููุญุงููุงุช
```

---

## ๐ ูุงุฆูุฉ ุงูุชุญูู

- [ ] ุชุทุจูู ุงููุฌุฑุฉ ูู Supabase
- [ ] ุชุฎุตูุต Email Templates
- [ ] ุฅุนุฏุงุฏ SMTP
- [ ] ุชุญุฏูุซ ูููุฐุฌ ุงูุชุณุฌูู
- [ ] ุงุฎุชุจุงุฑ ูุญูู
- [ ] ุงุฎุชุจุงุฑ ุนูู Vercel
- [ ] ูุฑุงูุจุฉ ุงูุฃุฎุทุงุก

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ

1. โ ุชุทุจูู ุงููุฌุฑุฉ
2. โ ุชุฎุตูุต Email Templates
3. โ ุชุญุฏูุซ ูููุฐุฌ ุงูุชุณุฌูู
4. โ ุงุฎุชุจุงุฑ ุงููุธุงู
5. โ ูุดุฑ ุนูู Vercel

---

**ุชู ุฅูุดุงุก ูุฐุง ุงูุฏููู ูุชุณููู ุชุทุจูู ูุธุงู OTP**

